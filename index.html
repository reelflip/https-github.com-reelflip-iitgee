<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IIT JEE Prep Tracker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Sidebar Active State */
        .active-nav { background-color: #eff6ff; color: #2563eb; border-right: 3px solid #2563eb; }
        
        /* Status Badges */
        .status-badge-completed { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .status-badge-progress { background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; }
        .status-badge-pending { background-color: #f3f4f6; color: #4b5563; border: 1px solid #e5e7eb; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Auth Specific */
        .auth-input-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #94a3b8; }
        .auth-input { padding-left: 2.75rem; }
    </style>
</head>
<body class="text-slate-800 h-screen overflow-hidden flex">

    <!-- Mobile Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed lg:static inset-y-0 left-0 w-64 bg-white border-r border-slate-200 transform -translate-x-full lg:translate-x-0 transition-transform duration-200 ease-in-out z-30 flex flex-col hidden h-full shadow-lg lg:shadow-none">
        <div class="p-6 border-b border-slate-100 flex items-center gap-3">
            <div class="w-8 h-8 bg-[#0F172A] rounded-full flex items-center justify-center text-white font-bold border-2 border-blue-500">
                <i class="fa-solid fa-arrow-up text-xs"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-slate-900 leading-tight">IIT <span class="text-orange-600">JEE</span></h1>
                <p class="text-[10px] text-blue-600 font-bold tracking-wider">TRACKER</p>
            </div>
        </div>

        <!-- Dynamic Nav -->
        <nav class="flex-1 overflow-y-auto py-4">
            <ul id="sidebar-nav" class="space-y-1">
                <!-- Injected via JS -->
            </ul>
        </nav>

        <div class="p-4 border-t border-slate-100">
            <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-2 text-sm font-medium text-slate-600 hover:text-red-600 transition-colors">
                <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="text-left flex-1">
                    <div id="user-name-display" class="text-slate-900 font-semibold leading-none mb-1">User</div>
                    <div class="text-xs text-slate-500">Log out <i class="fa-solid fa-arrow-right-from-bracket ml-1"></i></div>
                </div>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden bg-[#F3F4F6]">
        <!-- Header Mobile -->
        <header class="bg-white border-b border-slate-200 p-4 flex items-center justify-between lg:hidden z-10">
            <h1 class="text-lg font-bold text-slate-900">IIT <span class="text-orange-600">JEE</span> Prep</h1>
            <button onclick="toggleSidebar()" class="text-slate-600 focus:outline-none">
                <i class="fa-solid fa-bars text-xl"></i>
            </button>
        </header>

        <!-- Top Bar (Desktop) -->
        <header id="desktop-header" class="hidden lg:flex bg-white border-b border-slate-200 h-16 items-center justify-between px-8">
            <div class="text-sm breadcrumbs text-slate-500">
                <span id="page-title" class="font-bold text-slate-800 uppercase tracking-wide text-xs">Dashboard</span>
            </div>
            <div class="flex items-center gap-4">
                <!-- Role Badge -->
                <span id="role-badge" class="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold uppercase">Student</span>
                <div class="h-6 w-px bg-slate-200 mx-2"></div>
                <div class="flex items-center gap-2 text-slate-600 text-sm">
                   <i class="fa-regular fa-bell"></i>
                </div>
            </div>
        </header>

        <!-- Dynamic View Container -->
        <div id="app-view" class="flex-1 overflow-auto p-4 lg:p-8 relative scroll-smooth">
            <!-- Content Injected Here via JS -->
        </div>
    </main>

    <!-- JS Logic -->
    <script>
        // --- MOCK DATA (Fallback) ---
        const MOCK_DATA = {
            user: { name: 'Ishan', role: 'student', email: 'ishan@example.com' },
            motivation: {
                text: "Success is the sum of small efforts, repeated day in and day out.",
                author: "ROBERT COLLIER"
            },
            notices: [
                { id: 1, title: "Mock Test Schedule Update", msg: "The Major Test 3 has been rescheduled to next Sunday. Please prepare accordingly.", date: "2025-11-25", type: "urgent" },
                { id: 2, title: "Holiday Announcement", msg: "Institute will remain closed on Wednesday due to public holiday.", date: "2025-11-25", type: "info" }
            ],
            stats: {
                completed_topics: 4,
                total_topics: 60,
                overall_percentage: 7,
                time_remaining: "1 Yr 2 Mo",
                target_year: "IIT JEE 2027"
            },
            syllabus: [
                { id: 1, subject: 'Physics', phase: 'Phase 1', topic: 'Units, Dimensions & Errors', status: 'completed', est_hours: 8, progress: 100 },
                { id: 2, subject: 'Physics', phase: 'Phase 1', topic: 'Kinematics (1D, 2D, Relative)', status: 'completed', est_hours: 24, progress: 100 },
                { id: 3, subject: 'Physics', phase: 'Phase 1', topic: "Newton's Laws & Friction", status: 'completed', est_hours: 22, progress: 100 },
                { id: 4, subject: 'Physics', phase: 'Phase 2', topic: 'Work, Power & Energy', status: 'in_progress', est_hours: 18, progress: 45 },
                { id: 5, subject: 'Chemistry', phase: 'Phase 1', topic: 'Mole Concept', status: 'completed', est_hours: 12, progress: 100 },
                { id: 6, subject: 'Maths', phase: 'Phase 1', topic: 'Sets & Relations', status: 'not_started', est_hours: 10, progress: 0 },
            ],
            adminUsers: [
                { id: 1, full_name: 'Ishan Sharma', email: 'ishan@example.com', role: 'student', created_at: '2025-01-01' },
                { id: 2, full_name: 'System Admin', email: 'admin@example.com', role: 'admin', created_at: '2025-01-01' },
            ]
        };

        const NAV_ITEMS = {
            student: [
                { id: 'dashboard', label: 'Dashboard', icon: 'fa-table-columns' },
                { id: 'syllabus', label: 'Syllabus', icon: 'fa-book-open' },
                { id: 'analytics', label: 'Analytics', icon: 'fa-chart-simple' },
                { id: 'practice', label: 'Practice', icon: 'fa-square-check' },
                { id: 'mock-tests', label: 'Mock Exams', icon: 'fa-file-lines' },
                { id: 'planner', label: 'Planner', icon: 'fa-route' },
                { id: 'timetable', label: 'Timetable', icon: 'fa-calendar-days' },
            ],
            parent: [
                { id: 'dashboard', label: 'Overview', icon: 'fa-table-columns' },
                { id: 'analytics', label: 'Progress Reports', icon: 'fa-chart-pie' },
                { id: 'timetable', label: 'Student Schedule', icon: 'fa-calendar-days' },
            ],
            admin: [
                { id: 'user-management', label: 'User Management', icon: 'fa-users' },
                { id: 'content-management', label: 'Content Manager', icon: 'fa-layer-group' },
                { id: 'settings', label: 'System Settings', icon: 'fa-gear' },
            ]
        };

        // --- APP STATE ---
        const state = {
            currentUser: localStorage.getItem('jee_user') ? JSON.parse(localStorage.getItem('jee_user')) : null,
            view: 'login', 
            authMode: 'login',
            filters: { subject: 'All', search: '' }
        };

        // --- NAVIGATION & INIT ---
        function init() {
            if (state.currentUser) {
                document.getElementById('sidebar').classList.remove('hidden');
                document.getElementById('desktop-header').classList.remove('hidden');
                document.getElementById('user-name-display').textContent = state.currentUser.name || state.currentUser.full_name;
                
                // Set Role Badge
                const roleBadge = document.getElementById('role-badge');
                roleBadge.textContent = state.currentUser.role;
                roleBadge.className = `px-3 py-1 rounded-full text-xs font-bold uppercase ${
                    state.currentUser.role === 'admin' ? 'bg-purple-100 text-purple-700' : 'bg-blue-50 text-blue-600'
                }`;

                renderSidebar();

                // Default Route based on role
                if (state.currentUser.role === 'admin') {
                    navigate('user-management');
                } else {
                    navigate('dashboard');
                }
            } else {
                document.getElementById('sidebar').classList.add('hidden');
                document.getElementById('desktop-header').classList.add('hidden');
                renderAuth();
            }
        }

        function renderSidebar() {
            const role = state.currentUser.role || 'student';
            const items = NAV_ITEMS[role] || NAV_ITEMS['student'];
            const navList = document.getElementById('sidebar-nav');
            
            navList.innerHTML = items.map(item => `
                <li>
                    <a href="#" onclick="navigate('${item.id}')" id="nav-${item.id}" class="flex items-center gap-3 px-6 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors">
                        <i class="fa-solid ${item.icon} w-5 text-center"></i> ${item.label}
                    </a>
                </li>
            `).join('');
        }

        async function fetchData(endpoint) {
            try {
                const response = await fetch(endpoint);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.json();
            } catch (error) {
                console.warn(`Backend ${endpoint} unavailable, using Mock Data.`);
                return MOCK_DATA;
            }
        }

        function navigate(viewName) {
            state.view = viewName;
            
            // Update Sidebar UI
            document.querySelectorAll('#sidebar-nav a').forEach(el => el.classList.remove('active-nav'));
            const navLink = document.getElementById(`nav-${viewName}`);
            if(navLink) navLink.classList.add('active-nav');

            // Update Title
            const titleMap = {
                'dashboard': 'Student Dashboard',
                'user-management': 'User Administration',
                'syllabus': 'Syllabus Tracker',
                'content-management': 'Content Management'
            };
            const pageTitle = document.getElementById('page-title');
            if(pageTitle) pageTitle.textContent = titleMap[viewName] || viewName.replace('-', ' ');

            const container = document.getElementById('app-view');
            container.innerHTML = '';
            container.className = 'flex-1 overflow-auto p-4 lg:p-8 relative scroll-smooth fade-in';

            if (state.currentUser.role === 'admin') {
                switch(viewName) {
                    case 'user-management': renderAdminUsers(container); break;
                    default: container.innerHTML = `<div class="p-8 text-center text-slate-500">Admin Module <b>${viewName}</b> is under development.</div>`;
                }
            } else {
                switch(viewName) {
                    case 'dashboard': renderDashboard(container); break;
                    case 'syllabus': renderSyllabusView(container); break;
                    default: container.innerHTML = `<div class="p-8 text-center text-slate-500">Module <b>${viewName}</b> is under development.</div>`;
                }
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-menu-overlay');
            const isClosed = sidebar.classList.contains('-translate-x-full');
            
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        function logout() {
            localStorage.removeItem('jee_user');
            state.currentUser = null;
            init();
        }

        // --- AUTH VIEWS ---
        function toggleAuthMode(mode) {
            state.authMode = mode;
            renderAuth();
        }

        function renderAuth() {
            const container = document.getElementById('app-view');
            container.className = "flex-1 flex items-center justify-center bg-[#F3F4F6] p-4 min-h-screen overflow-y-auto";
            
            // Logo HTML
            const logoHtml = `
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold text-slate-800 mb-2 tracking-tight">IIT <span class="text-orange-600">JEE</span></h2>
                    <div class="w-20 h-20 bg-[#0F172A] rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-white shadow-xl relative z-10">
                        <i class="fa-solid fa-arrow-up text-3xl text-blue-400"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-blue-600 tracking-wide mb-1">TRACKER</h3>
                </div>
            `;

            if (state.authMode === 'register') {
                // Simplified register for brevity, similar to previous
                container.innerHTML = `
                <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-100 my-8">
                    ${logoHtml}
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-slate-900">Create Account</h2>
                        <button onclick="toggleAuthMode('login')" class="text-sm text-blue-600 hover:underline font-medium">Back to Login</button>
                    </div>
                    <form onsubmit="handleRegister(event)" class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Full Name</label>
                            <input type="text" id="reg-name" required placeholder="Student Name" class="w-full px-4 py-2 border border-slate-300 rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Email</label>
                            <input type="email" id="reg-email" required placeholder="student@example.com" class="w-full px-4 py-2 border border-slate-300 rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Password</label>
                            <input type="password" id="reg-pass" required class="w-full px-4 py-2 border border-slate-300 rounded-lg text-sm">
                        </div>
                         <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg mt-4">Create Account</button>
                    </form>
                </div>`;
            } else {
                container.innerHTML = `
                <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-100">
                    ${logoHtml}
                    <div class="text-center mb-6">
                        <h2 class="text-xl font-bold text-slate-900">Welcome Back</h2>
                        <p class="text-sm text-slate-500">Sign in to continue</p>
                    </div>
                    <form onsubmit="handleLogin(event)" class="space-y-5">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Email Address</label>
                            <input type="email" id="login-email" required class="w-full px-4 py-2.5 border border-slate-300 rounded-lg text-sm">
                            <p class="text-[10px] text-slate-400 mt-1">Try: ishan@example.com or admin@example.com</p>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Password</label>
                            <input type="password" id="login-pass" required class="w-full px-4 py-2.5 border border-slate-300 rounded-lg text-sm">
                            <p class="text-[10px] text-slate-400 mt-1">Try: password (student) or admin123 (admin)</p>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg">Sign In</button>
                    </form>
                    <div class="mt-6 pt-6 border-t border-slate-100 text-center">
                        <button onclick="toggleAuthMode('register')" class="text-blue-600 hover:underline font-bold text-sm">Create Account</button>
                    </div>
                </div>`;
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-pass').value;

            try {
                const formData = new FormData();
                formData.append('email', email);
                formData.append('password', password);

                const response = await fetch('api/login.php', { method: 'POST', body: formData });
                const data = await response.json();
                
                if(data.status === 'success') {
                    localStorage.setItem('jee_user', JSON.stringify(data.user));
                    state.currentUser = data.user;
                    init();
                } else {
                    alert('Login Failed: ' + data.message);
                }
            } catch(e) {
                // Fallback for demo
                console.warn("Backend login failed, using mock", e);
                if(email.includes('admin')) {
                     const user = { name: 'System Admin', email: email, role: 'admin' };
                     localStorage.setItem('jee_user', JSON.stringify(user));
                     state.currentUser = user;
                } else {
                     const user = { name: 'Ishan Sharma', email: email, role: 'student' };
                     localStorage.setItem('jee_user', JSON.stringify(user));
                     state.currentUser = user;
                }
                init();
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            alert("Demo: Registration successful. Please login.");
            toggleAuthMode('login');
        }

        // --- DASHBOARDS ---

        async function renderAdminUsers(container) {
            let users = [];
            try {
                const response = await fetch('api/admin_users.php');
                const data = await response.json();
                if(data.status === 'success') users = data.users;
                else throw new Error('API Error');
            } catch (e) {
                users = MOCK_DATA.adminUsers;
            }

            const rows = users.map(user => `
                <tr class="hover:bg-slate-50 border-b border-slate-100 last:border-0 transition-colors">
                    <td class="px-6 py-4 text-sm font-medium text-slate-900">#${user.id}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold text-xs">
                                ${user.full_name ? user.full_name.charAt(0) : 'U'}
                            </div>
                            <div>
                                <div class="text-sm font-medium text-slate-900">${user.full_name}</div>
                                <div class="text-xs text-slate-500">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                            user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 
                            (user.role === 'parent' ? 'bg-orange-100 text-orange-800' : 'bg-blue-100 text-blue-800')
                        }">
                            ${user.role}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-500">${user.created_at || 'N/A'}</td>
                    <td class="px-6 py-4 text-right">
                        ${user.role !== 'admin' ? `
                            <button onclick="deleteUser(${user.id})" class="text-red-500 hover:text-red-700 bg-red-50 hover:bg-red-100 px-3 py-1 rounded text-xs font-medium transition-colors">
                                Delete
                            </button>
                        ` : '<span class="text-xs text-slate-400">Protected</span>'}
                    </td>
                </tr>
            `).join('');

            container.innerHTML = `
                <div class="max-w-6xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900">User Management</h2>
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm transition-colors">
                            <i class="fa-solid fa-plus mr-2"></i> Add User
                        </button>
                    </div>
                    
                    <div class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="bg-slate-50 border-b border-slate-200">
                                        <th class="px-6 py-3 text-xs font-bold text-slate-500 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-xs font-bold text-slate-500 uppercase tracking-wider">User Details</th>
                                        <th class="px-6 py-3 text-xs font-bold text-slate-500 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-3 text-xs font-bold text-slate-500 uppercase tracking-wider">Joined</th>
                                        <th class="px-6 py-3 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${rows}
                                </tbody>
                            </table>
                        </div>
                         ${users.length === 0 ? '<div class="p-8 text-center text-slate-500">No users found.</div>' : ''}
                    </div>
                </div>
            `;
        }

        async function deleteUser(id) {
            if(!confirm('Are you sure you want to delete this user?')) return;
            try {
                const response = await fetch('api/delete_user.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: id })
                });
                const res = await response.json();
                if(res.status === 'success') {
                    navigate('user-management'); // Refresh
                } else {
                    alert('Error deleting user');
                }
            } catch(e) {
                alert('Demo: User deleted locally');
                navigate('user-management');
            }
        }

        async function renderDashboard(container) {
            const data = await fetchData('api/dashboard.php'); 
            
            // Reusing the logic from previous index.html for Student Dashboard...
            // ... (Abbreviated to avoid massive duplication, inserting essential parts) ...
            
            // Build Notices HTML
            const noticesHtml = data.notices.map(notice => `
                <div class="bg-white p-4 border-l-4 ${notice.type === 'urgent' ? 'border-red-500 bg-red-50' : 'border-blue-500'} rounded-r-lg shadow-sm mb-3">
                    <div class="flex justify-between items-start mb-1">
                        <h4 class="text-sm font-bold ${notice.type === 'urgent' ? 'text-red-700' : 'text-slate-800'}">${notice.title}</h4>
                        <span class="text-[10px] bg-white px-2 py-0.5 rounded border border-slate-200 text-slate-500"><i class="fa-regular fa-calendar mr-1"></i> ${notice.date}</span>
                    </div>
                    <p class="text-xs text-slate-600">${notice.msg}</p>
                </div>
            `).join('');

            // Syllabus Logic
            const phases = {};
            data.syllabus.forEach(item => {
                if(!phases[item.phase]) phases[item.phase] = [];
                phases[item.phase].push(item);
            });
            let allSyllabusHtml = '';
            for (const [phaseName, items] of Object.entries(phases)) {
                allSyllabusHtml += `<div class="mb-8"><h3 class="text-lg font-bold text-slate-800 mb-4 border-b border-slate-200 pb-2">${phaseName}</h3><div class="space-y-3">` +
                items.map(item => `
                    <div class="bg-white border border-slate-100 rounded-xl p-4 flex items-center justify-between shadow-sm">
                        <div>
                             <div class="flex items-center gap-2 mb-1"><span class="px-2 py-0.5 bg-purple-100 text-purple-700 text-[10px] font-bold uppercase rounded">${item.subject}</span></div>
                             <h3 class="font-semibold text-slate-800">${item.topic}</h3>
                             <div class="text-xs text-slate-400 mt-1">Est. ${item.est_hours} Hrs</div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${item.status==='completed'?'bg-green-100 text-green-700':'bg-slate-100 text-slate-600'}">${item.status.replace('_',' ')}</span>
                    </div>
                `).join('') + `</div></div>`;
            }

            container.innerHTML = `
                <div class="max-w-6xl mx-auto space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 bg-gradient-to-br from-[#8B5CF6] to-[#7C3AED] rounded-xl p-6 text-white shadow-lg">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-purple-200 mb-2"><i class="fa-solid fa-bolt mr-1"></i> Daily Motivation</h3>
                            <p class="text-xl font-serif italic mb-4">"${data.motivation.text}"</p>
                            <p class="text-sm font-bold text-purple-100">${data.motivation.author}</p>
                        </div>
                        <div class="lg:col-span-2 bg-[#FFF7ED] border border-orange-100 rounded-xl p-4 shadow-sm">
                             <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2"><i class="fa-solid fa-bullhorn text-orange-500"></i> Notices</h3>
                             ${noticesHtml}
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-900 mb-2">Welcome Back, ${state.currentUser.name}!</h2>
                        <div class="w-full bg-slate-100 rounded-full h-2.5 mt-4"><div class="bg-blue-600 h-2.5 rounded-full" style="width: ${data.stats.overall_percentage}%"></div></div>
                        <p class="text-xs text-slate-500 mt-2">${data.stats.overall_percentage}% Course Completed</p>
                    </div>
                    ${allSyllabusHtml}
                </div>
            `;
        }

        function renderSyllabusView(container) { container.innerHTML = '<div class="p-4 text-center">Detailed Syllabus View</div>'; }

        // Logic for updating status
        async function updateTopicStatus(id, newStatus) {
            try {
                await fetch('api/update_topic.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic_id: id, status: newStatus })
                });
            } catch (e) { console.error(e); }
        }

        init();
    </script>
</body>
</html>